(this.webpackJsonpapp=this.webpackJsonpapp||[]).push([[0],{33:function(e,t,a){e.exports=a(86)},38:function(e,t,a){},39:function(e,t,a){},86:function(e,t,a){"use strict";a.r(t);var n=a(0),s=a.n(n),r=a(13),i=a.n(r),o=(a(38),a(39),a(3)),c=a(4),l=a(7),u=a(8),d=a(5),m=a(9),h=a.n(m),f=a(19),p=new(function(){function e(){Object(o.a)(this,e),this.roomId=new URL(window.location.href).searchParams.get("room"),this.senderId=parseInt(new URL(window.location.href).searchParams.get("id")),this.lastMsgId=-1,this.url=""}return Object(c.a)(e,[{key:"messages",value:function(e){var t=this;console.log(this.roomId+" "+this.senderId);var a=this.senderId;return new Promise((function(n,s){h.a.get(t.url+"/chat/api/rooms/"+t.roomId+"/"+t.senderId).then((function(s){if(e&&s.data.data.messages.length>0&&(t.lastMsgId=s.data.data.messages[s.data.data.messages.length-1].id),0===s.data.data.users.filter((function(e){return e.id===a})).length)throw t.error;return n(s.data)})).catch((function(e){return s(e)}))}))}},{key:"sendMessage",value:function(e){var t=this,a=f();return e.sender.id=this.senderId,e.clientId=a,new Promise((function(a,n){h.a.post(t.url+"/chat/api/rooms/"+t.roomId+"/messages/",e).then((function(e){return e.data.data.id>t.lastMsgId&&(t.lastMsgId=e.data.data.id),a(e.data.data)})).catch((function(e){return n(e)}))}))}},{key:"checkMessages",value:function(){var e=this;return new Promise((function(t,a){h.a.get(e.url+"/chat/api/rooms/"+e.roomId+"/messages/"+e.lastMsgId+"/"+e.senderId).then((function(a){return a.data.data.messages.length>0&&(e.lastMsgId=a.data.data.messages[a.data.data.messages.length-1].id),t(a.data)})).catch((function(e){return a(e)}))}))}},{key:"sendFile",value:function(){var e=this,t=new FormData,a=document.querySelector('input[type="file"]').files[0];return t.append("file",a),t.append("senderId",this.senderId),t.append("clientId",f()),t.append("type","file"),new Promise((function(a,n){h.a.post(e.url+"/chat/api/rooms/"+e.roomId+"/files/",t,{headers:{"Content-Type":"multipart/form-data"}}).then((function(e){return a(e.data.data)})).catch((function(e){return n(e)}))}))}},{key:"getFile",value:function(e){var t=this;return new Promise((function(a,n){h.a.get(t.url+"/chat/api/rooms/file/"+e).then((function(e){return a(e.data.data)})).catch((function(e){return n(e)}))}))}},{key:"getHref",value:function(e){return this.url+"/chat/api/rooms/file/"+e}}]),e}()),g=a(6),v=a.n(g);a(29);v.a.locale("it");var b=function(e){Object(u.a)(a,e);var t=Object(l.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e="left align-self-start",t="left-text",a=this.props.msg.sender._name||this.props.msg.sender.user.nickName;this.props.msg.sender.id===p.senderId&&(e="right align-self-end",t="right-text",a="");var n=v()(new Date(this.props.msg.createdAt)).format("D MMM HH:mm");return v()(new Date).isSame(this.props.msg.createdAt,"day")&&(n=v()(new Date(this.props.msg.createdAt)).format("HH:mm")),s.a.createElement("div",{className:e+" message wordwrap"},s.a.createElement("div",{className:t+" message-text d-flex flex-column"},s.a.createElement("div",{className:"name-text align-self-start"},a),s.a.createElement("div",null,this.props.msg.text),s.a.createElement("div",{className:"date-text align-self-end"},n)))}}]),a}(s.a.Component),y=Object(d.b)(null)(b),w=a(10),I=a(11);v.a.locale("it");var E=function(e){Object(u.a)(a,e);var t=Object(l.a)(a);function a(){var e;return Object(o.a)(this,a),(e=t.call(this)).downloadFile=function(){p.getFile(JSON.parse(e.props.msg.text).id).then((function(e){return console.log(e)}))},e.state={color:"white"},e}return Object(c.a)(a,[{key:"render",value:function(){var e=this,t="left align-self-start",a="left-text",n=this.props.msg.sender._name||this.props.msg.sender.user.nickName;this.props.msg.sender.id===p.senderId&&(t="right align-self-end",a="right-text",n="");var r=v()(new Date(this.props.msg.createdAt)).format("D MMM HH:mm");return v()(new Date).isSame(this.props.msg.createdAt,"day")&&(r=v()(new Date(this.props.msg.createdAt)).format("HH:mm")),s.a.createElement("div",{className:t+" message wordwrap"},s.a.createElement("div",{className:a+" message-text d-flex flex-column"},s.a.createElement("div",{className:"name-text align-self-start"},n),s.a.createElement("div",null,s.a.createElement("a",{type:"button",className:"btn btn-outline-light m-2",href:p.getHref(JSON.parse(this.props.msg.text).id),download:JSON.parse(this.props.msg.text).name,onMouseOver:function(){return e.setState({color:"#4e73df"})},onMouseLeave:function(){return e.setState({color:"white"})},onClick:this.downloadFile},s.a.createElement(w.a,{icon:I.a,style:{color:this.state.color}})),JSON.parse(this.props.msg.text).name),s.a.createElement("div",{className:"date-text align-self-end"},r)))}}]),a}(s.a.Component),O=Object(d.b)(null)(E),x=function(e){return e.messages},j=function(e){return x(e)?x(e):[]},M=function(e){return{type:"ADD_MESSAGE",payload:e}},k=function(e){Object(u.a)(a,e);var t=Object(l.a)(a);function a(){var e;return Object(o.a)(this,a),(e=t.call(this)).handleChange=function(t){e.setState({message:t.target.value})},e.handleSubmit=function(t){var a=t.target.value.trim();13===t.which&&0===a.length&&(t.preventDefault(),e.setState({message:""})),13===t.which&&a.length>0&&e.submitMsg()},e.submitMsg=function(){if(e.state.message.trim()){var t={sender:{},type:"text",text:e.state.message};p.sendMessage(t).then((function(t){t&&(e.props.addMessage(t),e.setState({message:""}),setTimeout((function(){e.props.scroll()})))}))}else e.setState({message:""})},e.submitFile=function(){p.sendFile({sender:{},type:"file",text:""}).then((function(t){t&&(e.props.addMessage(t),setTimeout((function(){e.props.scroll()})))}))},e.state={message:""},e}return Object(c.a)(a,[{key:"render",value:function(){var e=this;return s.a.createElement("form",{className:"send-message-form"},s.a.createElement("div",{className:"d-flex"},s.a.createElement("textarea",{placeholder:"Digita un messaggio e premi INVIO",onChange:this.handleChange,onKeyDown:this.handleSubmit,value:this.state.message}),s.a.createElement("button",{type:"button",onClick:this.submitMsg,className:"btn btn-outline-primary m-3"},s.a.createElement(w.a,{icon:I.b})),s.a.createElement("button",{type:"button",onClick:function(){e.fileUpload.click()},className:"btn btn-outline-primary mt-3 mb-3 mr-3 file-button"},s.a.createElement(w.a,{icon:I.c})),s.a.createElement("input",{hidden:!0,type:"file",ref:function(t){e.fileUpload=t},onChange:this.submitFile})))}}]),a}(n.Component),N=Object(d.b)(null,{addMessage:M})(k),S=function(e){Object(u.a)(a,e);var t=Object(l.a)(a);function a(){var e;Object(o.a)(this,a);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(e=t.call.apply(t,[this].concat(s))).handleScroll=function(){e.textInput.scrollIntoView(!1),e.textInput.scrollTo(0,e.textInput.scrollHeight)},e.checkMessages=function(){p.checkMessages().then((function(t){t.data.messages.forEach((function(t){e.props.addMessage(t),e.handleScroll()}))})),p.messages()},e}return Object(c.a)(a,[{key:"componentDidMount",value:function(){var e=this;this.handleScroll(),this.interval=setInterval((function(){return e.checkMessages()}),1e3)}},{key:"componentWillUnmount",value:function(){clearInterval(this.interval)}},{key:"render",value:function(){var e=this;return s.a.createElement("div",{className:"list-container"},s.a.createElement("div",{ref:function(t){e.textInput=t},className:"message-list d-flex flex-column"},this.props.messages.map((function(e){return"text"===e.type?s.a.createElement(y,{key:e.id,msg:e}):s.a.createElement(O,{key:e.id,msg:e})}))),s.a.createElement(N,{scroll:function(){return e.handleScroll()}}))}}]),a}(n.Component),D=Object(d.b)((function(e){return{messages:j(e)}}),{addMessage:M})(S),C=a(31),A=a.n(C),H=function(e){Object(u.a)(a,e);var t=Object(l.a)(a);function a(){var e;return Object(o.a)(this,a),(e=t.call(this)).state={loaded:!1},e}return Object(c.a)(a,[{key:"init",value:function(){var e=this;p.messages(!0).then((function(t){t.data.messages&&(e.props.init(t.data.messages),setTimeout((function(){e.setState({loaded:!0})}),1e3))}))}},{key:"render",value:function(){return this.state.loaded?s.a.createElement(D,null):s.a.createElement("div",{className:"loader d-flex",onLoad:this.init()},s.a.createElement(A.a,{type:"Grid",color:"#4e73df",height:100,width:100}))}}]),a}(n.Component),F=Object(d.b)(null,{init:function(e){return{type:"INIT",payload:e}}})(H),P=a(14),T=a(32),J=a(21),U={messages:[],conversations:[]},L=Object(P.b)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:U,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"INIT":return Object(J.a)({},e,{messages:t.payload});case"ADD_MESSAGE":var a=Object(T.a)(e.messages);return 0===a.filter((function(e){return e.id===t.payload.id})).length&&a.push(t.payload),Object(J.a)({},e,{messages:a});default:return e}}));var _=function(){return s.a.createElement(d.a,{store:L},s.a.createElement("div",{className:"App"},s.a.createElement(F,null)))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a(85);i.a.render(s.a.createElement(_,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[33,1,2]]]);
//# sourceMappingURL=main.287728f2.chunk.js.map